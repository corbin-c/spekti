<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta name="theme-color" content="#b0c1d4"/>
    <title>SPEKTI</title>
  </head>
  <body>
    <button>CONNECT</button>
  </body>
  <script>
let searchToObject = () => {
  let search = window.location.search.split("?")[1];
  if (typeof search === "undefined") {
    return false;
  }
  let obj = {};
  search.split("&").forEach(e => {
    e = e.split("=");
    obj[e[0]] = e[1];
  });
  return obj;
}
if (searchToObject() !== false) {
  (async () => {
    let search = searchToObject();
    let auth = await fetch("http://0.0.0.0:3000/?code="+search.code, { method: "POST" });
    auth = await auth.json();
    console.log(auth);
  })();
}
console.log(window.location.search.split("?")[1]);
let connect = () => {
  console.log("connect");
  window.open("https://github.com/login/oauth/authorize?client_id=0cee4fa1d5515821c183&redirect_uri=http://localhost:8080/oauth.html&scope=gist");
} 
document.querySelector("button").addEventListener("click",connect);
  </script>
</html>
